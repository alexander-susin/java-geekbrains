node {
    def server = Artifactory.server 'artifactory'
    def rtMaven = Artifactory.newMavenBuild()

    stage ('Clone') {
        git url: 'https://github.com/malkinfedor/java_hello_servlet.git'
    }

    stage ('Get data from Git commit'){
        sh 'cd "${WORKSPACE}"; /var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/mvn_3.5.4/bin/mvn clean install; echo $git.dirty' 
        sh 'deploy-file.sh *.war "asusin_app_test-release/com/geekcap/vmturbo/hello-world-servlet-example/"'

        sh 'git checkout remotes/origin/misc'
        GIT_HASH = sh (
        
        script: '${WORKSPACE}/misc/getHashAndDate.sh hash',
        returnStdout: true
        ).trim()
        echo "Git commit hash: ${GIT_HASH}"
        
        GIT_DATE = sh (
        script: '${WORKSPACE}/misc/getHashAndDate.sh date',
        returnStdout: true
        ).trim()
        echo "Git commit hash: ${GIT_DATE}"
        sh 'git checkout master'
    }
  
}
